--PROCEDURE CODE (COUNT ALL THE SATURDAY DATE BY PASSING YEAR AND RUN TIME)
CREATE OR REPLACE PROCEDURE SP_SAT(P_YEAR NUMBER) AS
S_DATE DATE;
E_DATE DATE;
C NUMBER(5);
BEGIN
S_DATE :=TRUNC(TO_DATE(P_YEAR,'YY'));
E_DATE :=ADD_MONTHS(S_DATE,12)-1;
C:=0;
WHILE S_DATE<=E_DATE LOOP
IF TO_CHAR(S_DATE,'DY') IN ('SAT') THEN
C:=C+1;
END IF;
S_DATE :=S_DATE+1;
END LOOP;
DBMS_OUTPUT.PUT_LINE('NO_OF_SAT_DAYS '||C);
END;

SET SERVEROUTPUT ON

EXEC SP_SAT(2022);

--WRITE A PROCEDURE BY PASSING A STRING DISPLAY IT IN REVERSE ORDER
CREATE OR REPLACE PROCEDURE SP_REVERSE (A VARCHAR) AS
L NUMBER(5);
BEGIN
L :=LENGTH(A);
FOR I IN REVERSE 1..L LOOP
DBMS_OUTPUT.PUT_LINE(SUBSTR(A,I,1));
END LOOP;
END;

EXEC SP_REVERSE('AROHA');

--WRITE PROCEDURE TO INSERT RECORD OF TGT TABLE FROM SRC TABLE BUT BEFORE INSERTING 
--CHECK WHERE IT EXISST OR NOT
CREATE TABLE SRC(CID NUMBER(5),NM VARCHAR(10),CITY VARCHAR(20));
CREATE TABLE TGT(CID NUMBER(5),NM VARCHAR(10),CITY VARCHAR(20));

INSERT INTO SRC VALUES(12,'ABC','BAN');
INSERT INTO SRC VALUES(13,'XYZ','CHN');
INSERT INTO SRC VALUES(14,'EFG','CBE');

INSERT INTO TGT VALUES(13,'XYZ','CHN');

CREATE OR REPLACE PROCEDURE STU_SP AS
CURSOR GET_DATA IS (SELECT CID,NM,CITY
                    FROM SRC);
VCNT NUMBER(10);
BEGIN
FOR I IN GET_DATA LOOP
SELECT COUNT(*) INTO VCNT FROM TGT
        WHERE CID=I.CID AND NM=I.NM AND CITY=I.CITY;

IF VCNT=0 THEN
    INSERT INTO TGT VALUES(I.CID,I.NM,I.CITY);
ELSE
    DBMS_OUTPUT.PUT_LINE('ALREADY INSERTED');
END IF;
END LOOP;
END;

EXEC STU_SP;
    
SELECT * FROM TGT;    
        
--WRITE A PROCEDURE TO RETURN THE FACTORIAL OF NUMBER
CREATE OR REPLACE FUNCTION FACT1(N IN NUMBER)RETURN  NUMBER AS
C NUMBER(10):=1;
BEGIN
FOR I IN 1..N LOOP
C :=C*I;
END LOOP;
RETURN C;
END;

SELECT FACT1(5)RESULT FROM DUAL;

--WRITE A PROCEDURE TO PRINT TOP 10 PRODUCTS BASED ON SALES AMOUNT
SELECT * FROM PRODUCT_RETAIL;
SELECT * FROM SALES_RETAIL;

CREATE OR REPLACE PROCEDURE SP_PRODUCT AS
BEGIN
FOR I IN (SELECT P_NAME
        FROM(SELECT P_NAME,DENSE_RANK() OVER
            (ORDER BY SUM(AMOUNT) DESC)R
            FROM SALES_RETAIL S,PRODUCT_RETAIL P
            WHERE S.PROD_ID=P.PROD_ID
            GROUP BY P_NAME)
        WHERE R<2) LOOP
DBMS_OUTPUT.PUT_LINE(I.P_NAME);
END LOOP;
END;

EXEC SP_PRODUCT;